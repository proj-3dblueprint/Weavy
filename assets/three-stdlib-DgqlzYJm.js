import{R as sr,M as lr,I as cr,S as ur,D as vr,V as Pe,a as rt,T as nt,b as jt,Q as Xt,O as Ft,c as xe,P as kt,d as hr,e as pr,f as Vt,H as He,F as ot,g as at,L as Dt,h as fr,i as mr}from"./three-CCuf2VqA.js";const qt=parseInt(sr.replace(/\D+/g,""));var Me=Uint8Array,Ye=Uint16Array,Zt=Uint32Array,$t=new Me([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Qt=new Me([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),dr=new Me([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Jt=function(f,l){for(var h=new Ye(31),r=0;r<31;++r)h[r]=l+=1<<f[r-1];for(var U=new Zt(h[30]),r=1;r<30;++r)for(var z=h[r];z<h[r+1];++z)U[z]=z-h[r]<<5|r;return[h,U]},er=Jt($t,2),tr=er[0],Er=er[1];tr[28]=258,Er[258]=28;var gr=Jt(Qt,0),wr=gr[0],Ht=new Ye(32768);for(var ee=0;ee<32768;++ee){var Ze=(ee&43690)>>>1|(ee&21845)<<1;Ze=(Ze&52428)>>>2|(Ze&13107)<<2,Ze=(Ze&61680)>>>4|(Ze&3855)<<4,Ht[ee]=((Ze&65280)>>>8|(Ze&255)<<8)>>>1}var pt=function(f,l,h){for(var r=f.length,U=0,z=new Ye(l);U<r;++U)++z[f[U]-1];var M=new Ye(l);for(U=0;U<l;++U)M[U]=M[U-1]+z[U-1]<<1;var A;if(h){A=new Ye(1<<l);var _=15-l;for(U=0;U<r;++U)if(f[U])for(var B=U<<4|f[U],C=l-f[U],G=M[f[U]-1]++<<C,re=G|(1<<C)-1;G<=re;++G)A[Ht[G]>>>_]=B}else for(A=new Ye(r),U=0;U<r;++U)f[U]&&(A[U]=Ht[M[f[U]-1]++]>>>15-f[U]);return A},ft=new Me(288);for(var ee=0;ee<144;++ee)ft[ee]=8;for(var ee=144;ee<256;++ee)ft[ee]=9;for(var ee=256;ee<280;++ee)ft[ee]=7;for(var ee=280;ee<288;++ee)ft[ee]=8;var rr=new Me(32);for(var ee=0;ee<32;++ee)rr[ee]=5;var _r=pt(ft,9,1),br=pt(rr,5,1),zt=function(f){for(var l=f[0],h=1;h<f.length;++h)f[h]>l&&(l=f[h]);return l},Le=function(f,l,h){var r=l/8|0;return(f[r]|f[r+1]<<8)>>(l&7)&h},Bt=function(f,l){var h=l/8|0;return(f[h]|f[h+1]<<8|f[h+2]<<16)>>(l&7)},Sr=function(f){return(f/8|0)+(f&7&&1)},yr=function(f,l,h){(h==null||h>f.length)&&(h=f.length);var r=new(f instanceof Ye?Ye:f instanceof Zt?Zt:Me)(h-l);return r.set(f.subarray(l,h)),r},Ir=function(f,l,h){var r=f.length;if(!r||h&&!h.l&&r<5)return l||new Me(0);var U=!l||h,z=!h||h.i;h||(h={}),l||(l=new Me(r*3));var M=function(Y){var Re=l.length;if(Y>Re){var Oe=new Me(Math.max(Re*2,Y));Oe.set(l),l=Oe}},A=h.f||0,_=h.p||0,B=h.b||0,C=h.l,G=h.d,re=h.m,le=h.n,ue=r*8;do{if(!C){h.f=A=Le(f,_,1);var ve=Le(f,_+1,3);if(_+=3,ve)if(ve==1)C=_r,G=br,re=9,le=5;else if(ve==2){var we=Le(f,_,31)+257,me=Le(f,_+10,15)+4,_e=we+Le(f,_+5,31)+1;_+=14;for(var he=new Me(_e),be=new Me(19),w=0;w<me;++w)be[dr[w]]=Le(f,_+w*3,7);_+=me*3;for(var x=zt(be),S=(1<<x)-1,Z=pt(be,x,1),w=0;w<_e;){var F=Z[Le(f,_,S)];_+=F&15;var Q=F>>>4;if(Q<16)he[w++]=Q;else{var N=0,D=0;for(Q==16?(D=3+Le(f,_,3),_+=2,N=he[w-1]):Q==17?(D=3+Le(f,_,7),_+=3):Q==18&&(D=11+Le(f,_,127),_+=7);D--;)he[w++]=N}}var X=he.subarray(0,we),O=he.subarray(we);re=zt(X),le=zt(O),C=pt(X,re,1),G=pt(O,le,1)}else throw"invalid block type";else{var Q=Sr(_)+4,oe=f[Q-4]|f[Q-3]<<8,fe=Q+oe;if(fe>r){if(z)throw"unexpected EOF";break}U&&M(B+oe),l.set(f.subarray(Q,fe),B),h.b=B+=oe,h.p=_=fe*8;continue}if(_>ue){if(z)throw"unexpected EOF";break}}U&&M(B+131072);for(var Se=(1<<re)-1,ye=(1<<le)-1,de=_;;de=_){var N=C[Bt(f,_)&Se],H=N>>>4;if(_+=N&15,_>ue){if(z)throw"unexpected EOF";break}if(!N)throw"invalid length/literal";if(H<256)l[B++]=H;else if(H==256){de=_,C=null;break}else{var Ue=H-254;if(H>264){var w=H-257,W=$t[w];Ue=Le(f,_,(1<<W)-1)+tr[w],_+=W}var ae=G[Bt(f,_)&ye],Ie=ae>>>4;if(!ae)throw"invalid distance";_+=ae&15;var O=wr[Ie];if(Ie>3){var W=Qt[Ie];O+=Bt(f,_)&(1<<W)-1,_+=W}if(_>ue){if(z)throw"unexpected EOF";break}U&&M(B+131072);for(var Ge=B+Ue;B<Ge;B+=4)l[B]=l[B-O],l[B+1]=l[B+1-O],l[B+2]=l[B+2-O],l[B+3]=l[B+3-O];B=Ge}}h.l=C,h.p=de,h.b=B,C&&(A=1,h.m=re,h.d=G,h.n=le)}while(!A);return B==l.length?l:yr(l,0,B)},Tr=new Me(0),Ur=function(f){if((f[0]&15)!=8||f[0]>>>4>7||(f[0]<<8|f[1])%31)throw"invalid zlib data";if(f[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Ut(f,l){return Ir((Ur(f),f.subarray(2,-4)),l)}var Ar=typeof TextDecoder<"u"&&new TextDecoder,Dr=0;try{Ar.decode(Tr,{stream:!0}),Dr=1}catch{}const Mr=f=>f&&f.isCubeTexture;class kr extends lr{constructor(l,h){var r,U;const z=Mr(l),A=((U=z?(r=l.image[0])==null?void 0:r.width:l.image.width)!=null?U:1024)/4,_=Math.floor(Math.log2(A)),B=Math.pow(2,_),C=3*Math.max(B,16*7),G=4*B,re=[z?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/C}`,`#define CUBEUV_TEXEL_HEIGHT ${1/G}`,`#define CUBEUV_MAX_MIP ${_}.0`],le=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,ue=re.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${qt>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,ve={map:{value:l},height:{value:h?.height||15},radius:{value:h?.radius||100}},Q=new cr(1,16),oe=new ur({uniforms:ve,fragmentShader:ue,vertexShader:le,side:vr});super(Q,oe)}set radius(l){this.material.uniforms.radius.value=l}get radius(){return this.material.uniforms.radius.value}set height(l){this.material.uniforms.height.value=l}get height(){return this.material.uniforms.height.value}}var Rr=Object.defineProperty,Or=(f,l,h)=>l in f?Rr(f,l,{enumerable:!0,configurable:!0,writable:!0,value:h}):f[l]=h,Cr=(f,l,h)=>(Or(f,l+"",h),h);class Nr{constructor(){Cr(this,"_listeners")}addEventListener(l,h){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[l]===void 0&&(r[l]=[]),r[l].indexOf(h)===-1&&r[l].push(h)}hasEventListener(l,h){if(this._listeners===void 0)return!1;const r=this._listeners;return r[l]!==void 0&&r[l].indexOf(h)!==-1}removeEventListener(l,h){if(this._listeners===void 0)return;const U=this._listeners[l];if(U!==void 0){const z=U.indexOf(h);z!==-1&&U.splice(z,1)}}dispatchEvent(l){if(this._listeners===void 0)return;const r=this._listeners[l.type];if(r!==void 0){l.target=this;const U=r.slice(0);for(let z=0,M=U.length;z<M;z++)U[z].call(this,l);l.target=null}}}var Pr=Object.defineProperty,xr=(f,l,h)=>l in f?Pr(f,l,{enumerable:!0,configurable:!0,writable:!0,value:h}):f[l]=h,T=(f,l,h)=>(xr(f,typeof l!="symbol"?l+"":l,h),h);const At=new hr,Wt=new pr,Lr=Math.cos(70*(Math.PI/180)),Kt=(f,l)=>(f%l+l)%l;class zr extends Nr{constructor(l,h){super(),T(this,"object"),T(this,"domElement"),T(this,"enabled",!0),T(this,"target",new Pe),T(this,"minDistance",0),T(this,"maxDistance",1/0),T(this,"minZoom",0),T(this,"maxZoom",1/0),T(this,"minPolarAngle",0),T(this,"maxPolarAngle",Math.PI),T(this,"minAzimuthAngle",-1/0),T(this,"maxAzimuthAngle",1/0),T(this,"enableDamping",!1),T(this,"dampingFactor",.05),T(this,"enableZoom",!0),T(this,"zoomSpeed",1),T(this,"enableRotate",!0),T(this,"rotateSpeed",1),T(this,"enablePan",!0),T(this,"panSpeed",1),T(this,"screenSpacePanning",!0),T(this,"keyPanSpeed",7),T(this,"zoomToCursor",!1),T(this,"autoRotate",!1),T(this,"autoRotateSpeed",2),T(this,"reverseOrbit",!1),T(this,"reverseHorizontalOrbit",!1),T(this,"reverseVerticalOrbit",!1),T(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),T(this,"mouseButtons",{LEFT:rt.ROTATE,MIDDLE:rt.DOLLY,RIGHT:rt.PAN}),T(this,"touches",{ONE:nt.ROTATE,TWO:nt.DOLLY_PAN}),T(this,"target0"),T(this,"position0"),T(this,"zoom0"),T(this,"_domElementKeyEvents",null),T(this,"getPolarAngle"),T(this,"getAzimuthalAngle"),T(this,"setPolarAngle"),T(this,"setAzimuthalAngle"),T(this,"getDistance"),T(this,"getZoomScale"),T(this,"listenToKeyEvents"),T(this,"stopListenToKeyEvents"),T(this,"saveState"),T(this,"reset"),T(this,"update"),T(this,"connect"),T(this,"dispose"),T(this,"dollyIn"),T(this,"dollyOut"),T(this,"getScale"),T(this,"setScale"),this.object=l,this.domElement=h,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>C.phi,this.getAzimuthalAngle=()=>C.theta,this.setPolarAngle=a=>{let u=Kt(a,2*Math.PI),b=C.phi;b<0&&(b+=2*Math.PI),u<0&&(u+=2*Math.PI);let k=Math.abs(u-b);2*Math.PI-k<k&&(u<b?u+=2*Math.PI:b+=2*Math.PI),G.phi=u-b,r.update()},this.setAzimuthalAngle=a=>{let u=Kt(a,2*Math.PI),b=C.theta;b<0&&(b+=2*Math.PI),u<0&&(u+=2*Math.PI);let k=Math.abs(u-b);2*Math.PI-k<k&&(u<b?u+=2*Math.PI:b+=2*Math.PI),G.theta=u-b,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=a=>{a.addEventListener("keydown",Qe),this._domElementKeyEvents=a},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Qe),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(U),r.update(),_=A.NONE},this.update=(()=>{const a=new Pe,u=new Pe(0,1,0),b=new Xt().setFromUnitVectors(l.up,u),k=b.clone().invert(),p=new Pe,Ee=new Xt,Fe=2*Math.PI;return function(){const It=r.object.position;b.setFromUnitVectors(l.up,u),k.copy(b).invert(),a.copy(It).sub(r.target),a.applyQuaternion(b),C.setFromVector3(a),r.autoRotate&&_===A.NONE&&D(F()),r.enableDamping?(C.theta+=G.theta*r.dampingFactor,C.phi+=G.phi*r.dampingFactor):(C.theta+=G.theta,C.phi+=G.phi);let Ce=r.minAzimuthAngle,Ne=r.maxAzimuthAngle;isFinite(Ce)&&isFinite(Ne)&&(Ce<-Math.PI?Ce+=Fe:Ce>Math.PI&&(Ce-=Fe),Ne<-Math.PI?Ne+=Fe:Ne>Math.PI&&(Ne-=Fe),Ce<=Ne?C.theta=Math.max(Ce,Math.min(Ne,C.theta)):C.theta=C.theta>(Ce+Ne)/2?Math.max(Ce,C.theta):Math.min(Ne,C.theta)),C.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,C.phi)),C.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(le,r.dampingFactor):r.target.add(le),r.zoomToCursor&&x||r.object.isOrthographicCamera?C.radius=ae(C.radius):C.radius=ae(C.radius*re),a.setFromSpherical(C),a.applyQuaternion(k),It.copy(r.target).add(a),r.object.matrixAutoUpdate||r.object.updateMatrix(),r.object.lookAt(r.target),r.enableDamping===!0?(G.theta*=1-r.dampingFactor,G.phi*=1-r.dampingFactor,le.multiplyScalar(1-r.dampingFactor)):(G.set(0,0,0),le.set(0,0,0));let We=!1;if(r.zoomToCursor&&x){let Ke=null;if(r.object instanceof kt&&r.object.isPerspectiveCamera){const Ve=a.length();Ke=ae(Ve*re);const tt=Ve-Ke;r.object.position.addScaledVector(be,tt),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){const Ve=new Pe(w.x,w.y,0);Ve.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/re)),r.object.updateProjectionMatrix(),We=!0;const tt=new Pe(w.x,w.y,0);tt.unproject(r.object),r.object.position.sub(tt).add(Ve),r.object.updateMatrixWorld(),Ke=a.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;Ke!==null&&(r.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(Ke).add(r.object.position):(At.origin.copy(r.object.position),At.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(At.direction))<Lr?l.lookAt(r.target):(Wt.setFromNormalAndCoplanarPoint(r.object.up,r.target),At.intersectPlane(Wt,r.target))))}else r.object instanceof Ft&&r.object.isOrthographicCamera&&(We=re!==1,We&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/re)),r.object.updateProjectionMatrix()));return re=1,x=!1,We||p.distanceToSquared(r.object.position)>B||8*(1-Ee.dot(r.object.quaternion))>B?(r.dispatchEvent(U),p.copy(r.object.position),Ee.copy(r.object.quaternion),We=!1,!0):!1}})(),this.connect=a=>{r.domElement=a,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",yt),r.domElement.addEventListener("pointerdown",bt),r.domElement.addEventListener("pointercancel",je),r.domElement.addEventListener("wheel",St)},this.dispose=()=>{var a,u,b,k,p,Ee;r.domElement&&(r.domElement.style.touchAction="auto"),(a=r.domElement)==null||a.removeEventListener("contextmenu",yt),(u=r.domElement)==null||u.removeEventListener("pointerdown",bt),(b=r.domElement)==null||b.removeEventListener("pointercancel",je),(k=r.domElement)==null||k.removeEventListener("wheel",St),(p=r.domElement)==null||p.ownerDocument.removeEventListener("pointermove",$e),(Ee=r.domElement)==null||Ee.ownerDocument.removeEventListener("pointerup",je),r._domElementKeyEvents!==null&&r._domElementKeyEvents.removeEventListener("keydown",Qe)};const r=this,U={type:"change"},z={type:"start"},M={type:"end"},A={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let _=A.NONE;const B=1e-6,C=new jt,G=new jt;let re=1;const le=new Pe,ue=new xe,ve=new xe,Q=new xe,oe=new xe,fe=new xe,we=new xe,me=new xe,_e=new xe,he=new xe,be=new Pe,w=new xe;let x=!1;const S=[],Z={};function F(){return 2*Math.PI/60/60*r.autoRotateSpeed}function N(){return Math.pow(.95,r.zoomSpeed)}function D(a){r.reverseOrbit||r.reverseHorizontalOrbit?G.theta+=a:G.theta-=a}function X(a){r.reverseOrbit||r.reverseVerticalOrbit?G.phi+=a:G.phi-=a}const O=(()=>{const a=new Pe;return function(b,k){a.setFromMatrixColumn(k,0),a.multiplyScalar(-b),le.add(a)}})(),Se=(()=>{const a=new Pe;return function(b,k){r.screenSpacePanning===!0?a.setFromMatrixColumn(k,1):(a.setFromMatrixColumn(k,0),a.crossVectors(r.object.up,a)),a.multiplyScalar(b),le.add(a)}})(),ye=(()=>{const a=new Pe;return function(b,k){const p=r.domElement;if(p&&r.object instanceof kt&&r.object.isPerspectiveCamera){const Ee=r.object.position;a.copy(Ee).sub(r.target);let Fe=a.length();Fe*=Math.tan(r.object.fov/2*Math.PI/180),O(2*b*Fe/p.clientHeight,r.object.matrix),Se(2*k*Fe/p.clientHeight,r.object.matrix)}else p&&r.object instanceof Ft&&r.object.isOrthographicCamera?(O(b*(r.object.right-r.object.left)/r.object.zoom/p.clientWidth,r.object.matrix),Se(k*(r.object.top-r.object.bottom)/r.object.zoom/p.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function de(a){r.object instanceof kt&&r.object.isPerspectiveCamera||r.object instanceof Ft&&r.object.isOrthographicCamera?re=a:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function H(a){de(re/a)}function Ue(a){de(re*a)}function W(a){if(!r.zoomToCursor||!r.domElement)return;x=!0;const u=r.domElement.getBoundingClientRect(),b=a.clientX-u.left,k=a.clientY-u.top,p=u.width,Ee=u.height;w.x=b/p*2-1,w.y=-(k/Ee)*2+1,be.set(w.x,w.y,1).unproject(r.object).sub(r.object.position).normalize()}function ae(a){return Math.max(r.minDistance,Math.min(r.maxDistance,a))}function Ie(a){ue.set(a.clientX,a.clientY)}function Ge(a){W(a),me.set(a.clientX,a.clientY)}function Y(a){oe.set(a.clientX,a.clientY)}function Re(a){ve.set(a.clientX,a.clientY),Q.subVectors(ve,ue).multiplyScalar(r.rotateSpeed);const u=r.domElement;u&&(D(2*Math.PI*Q.x/u.clientHeight),X(2*Math.PI*Q.y/u.clientHeight)),ue.copy(ve),r.update()}function Oe(a){_e.set(a.clientX,a.clientY),he.subVectors(_e,me),he.y>0?H(N()):he.y<0&&Ue(N()),me.copy(_e),r.update()}function Mt(a){fe.set(a.clientX,a.clientY),we.subVectors(fe,oe).multiplyScalar(r.panSpeed),ye(we.x,we.y),oe.copy(fe),r.update()}function Rt(a){W(a),a.deltaY<0?Ue(N()):a.deltaY>0&&H(N()),r.update()}function mt(a){let u=!1;switch(a.code){case r.keys.UP:ye(0,r.keyPanSpeed),u=!0;break;case r.keys.BOTTOM:ye(0,-r.keyPanSpeed),u=!0;break;case r.keys.LEFT:ye(r.keyPanSpeed,0),u=!0;break;case r.keys.RIGHT:ye(-r.keyPanSpeed,0),u=!0;break}u&&(a.preventDefault(),r.update())}function dt(){if(S.length==1)ue.set(S[0].pageX,S[0].pageY);else{const a=.5*(S[0].pageX+S[1].pageX),u=.5*(S[0].pageY+S[1].pageY);ue.set(a,u)}}function it(){if(S.length==1)oe.set(S[0].pageX,S[0].pageY);else{const a=.5*(S[0].pageX+S[1].pageX),u=.5*(S[0].pageY+S[1].pageY);oe.set(a,u)}}function st(){const a=S[0].pageX-S[1].pageX,u=S[0].pageY-S[1].pageY,b=Math.sqrt(a*a+u*u);me.set(0,b)}function Et(){r.enableZoom&&st(),r.enablePan&&it()}function Ot(){r.enableZoom&&st(),r.enableRotate&&dt()}function gt(a){if(S.length==1)ve.set(a.pageX,a.pageY);else{const b=et(a),k=.5*(a.pageX+b.x),p=.5*(a.pageY+b.y);ve.set(k,p)}Q.subVectors(ve,ue).multiplyScalar(r.rotateSpeed);const u=r.domElement;u&&(D(2*Math.PI*Q.x/u.clientHeight),X(2*Math.PI*Q.y/u.clientHeight)),ue.copy(ve)}function wt(a){if(S.length==1)fe.set(a.pageX,a.pageY);else{const u=et(a),b=.5*(a.pageX+u.x),k=.5*(a.pageY+u.y);fe.set(b,k)}we.subVectors(fe,oe).multiplyScalar(r.panSpeed),ye(we.x,we.y),oe.copy(fe)}function _t(a){const u=et(a),b=a.pageX-u.x,k=a.pageY-u.y,p=Math.sqrt(b*b+k*k);_e.set(0,p),he.set(0,Math.pow(_e.y/me.y,r.zoomSpeed)),H(he.y),me.copy(_e)}function Ct(a){r.enableZoom&&_t(a),r.enablePan&&wt(a)}function Nt(a){r.enableZoom&&_t(a),r.enableRotate&&gt(a)}function bt(a){var u,b;r.enabled!==!1&&(S.length===0&&((u=r.domElement)==null||u.ownerDocument.addEventListener("pointermove",$e),(b=r.domElement)==null||b.ownerDocument.addEventListener("pointerup",je)),Lt(a),a.pointerType==="touch"?Je(a):lt(a))}function $e(a){r.enabled!==!1&&(a.pointerType==="touch"?xt(a):Pt(a))}function je(a){var u,b,k;Xe(a),S.length===0&&((u=r.domElement)==null||u.releasePointerCapture(a.pointerId),(b=r.domElement)==null||b.ownerDocument.removeEventListener("pointermove",$e),(k=r.domElement)==null||k.ownerDocument.removeEventListener("pointerup",je)),r.dispatchEvent(M),_=A.NONE}function lt(a){let u;switch(a.button){case 0:u=r.mouseButtons.LEFT;break;case 1:u=r.mouseButtons.MIDDLE;break;case 2:u=r.mouseButtons.RIGHT;break;default:u=-1}switch(u){case rt.DOLLY:if(r.enableZoom===!1)return;Ge(a),_=A.DOLLY;break;case rt.ROTATE:if(a.ctrlKey||a.metaKey||a.shiftKey){if(r.enablePan===!1)return;Y(a),_=A.PAN}else{if(r.enableRotate===!1)return;Ie(a),_=A.ROTATE}break;case rt.PAN:if(a.ctrlKey||a.metaKey||a.shiftKey){if(r.enableRotate===!1)return;Ie(a),_=A.ROTATE}else{if(r.enablePan===!1)return;Y(a),_=A.PAN}break;default:_=A.NONE}_!==A.NONE&&r.dispatchEvent(z)}function Pt(a){if(r.enabled!==!1)switch(_){case A.ROTATE:if(r.enableRotate===!1)return;Re(a);break;case A.DOLLY:if(r.enableZoom===!1)return;Oe(a);break;case A.PAN:if(r.enablePan===!1)return;Mt(a);break}}function St(a){r.enabled===!1||r.enableZoom===!1||_!==A.NONE&&_!==A.ROTATE||(a.preventDefault(),r.dispatchEvent(z),Rt(a),r.dispatchEvent(M))}function Qe(a){r.enabled===!1||r.enablePan===!1||mt(a)}function Je(a){switch(ce(a),S.length){case 1:switch(r.touches.ONE){case nt.ROTATE:if(r.enableRotate===!1)return;dt(),_=A.TOUCH_ROTATE;break;case nt.PAN:if(r.enablePan===!1)return;it(),_=A.TOUCH_PAN;break;default:_=A.NONE}break;case 2:switch(r.touches.TWO){case nt.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;Et(),_=A.TOUCH_DOLLY_PAN;break;case nt.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Ot(),_=A.TOUCH_DOLLY_ROTATE;break;default:_=A.NONE}break;default:_=A.NONE}_!==A.NONE&&r.dispatchEvent(z)}function xt(a){switch(ce(a),_){case A.TOUCH_ROTATE:if(r.enableRotate===!1)return;gt(a),r.update();break;case A.TOUCH_PAN:if(r.enablePan===!1)return;wt(a),r.update();break;case A.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;Ct(a),r.update();break;case A.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Nt(a),r.update();break;default:_=A.NONE}}function yt(a){r.enabled!==!1&&a.preventDefault()}function Lt(a){S.push(a)}function Xe(a){delete Z[a.pointerId];for(let u=0;u<S.length;u++)if(S[u].pointerId==a.pointerId){S.splice(u,1);return}}function ce(a){let u=Z[a.pointerId];u===void 0&&(u=new xe,Z[a.pointerId]=u),u.set(a.pageX,a.pageY)}function et(a){const u=a.pointerId===S[0].pointerId?S[1]:S[0];return Z[u.pointerId]}this.dollyIn=(a=N())=>{Ue(a),r.update()},this.dollyOut=(a=N())=>{H(a),r.update()},this.getScale=()=>re,this.setScale=a=>{de(a),r.update()},this.getZoomScale=()=>N(),h!==void 0&&this.connect(h),this.update()}}const Br={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},Zr={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `};class Hr extends Vt{constructor(l){super(l),this.type=He}parse(l){const M=function(w,x){switch(w){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(x||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(x||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(x||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(x||""))}},C=`
`,G=function(w,x,S){x=x||1024;let F=w.pos,N=-1,D=0,X="",O=String.fromCharCode.apply(null,new Uint16Array(w.subarray(F,F+128)));for(;0>(N=O.indexOf(C))&&D<x&&F<w.byteLength;)X+=O,D+=O.length,F+=128,O+=String.fromCharCode.apply(null,new Uint16Array(w.subarray(F,F+128)));return-1<N?(w.pos+=D+N+1,X+O.slice(0,N)):!1},re=function(w){const x=/^#\?(\S+)/,S=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,Z=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,F=/^\s*FORMAT=(\S+)\s*$/,N=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,D={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let X,O;for((w.pos>=w.byteLength||!(X=G(w)))&&M(1,"no header found"),(O=X.match(x))||M(3,"bad initial token"),D.valid|=1,D.programtype=O[1],D.string+=X+`
`;X=G(w),X!==!1;){if(D.string+=X+`
`,X.charAt(0)==="#"){D.comments+=X+`
`;continue}if((O=X.match(S))&&(D.gamma=parseFloat(O[1])),(O=X.match(Z))&&(D.exposure=parseFloat(O[1])),(O=X.match(F))&&(D.valid|=2,D.format=O[1]),(O=X.match(N))&&(D.valid|=4,D.height=parseInt(O[1],10),D.width=parseInt(O[2],10)),D.valid&2&&D.valid&4)break}return D.valid&2||M(3,"missing format specifier"),D.valid&4||M(3,"missing image size specifier"),D},le=function(w,x,S){const Z=x;if(Z<8||Z>32767||w[0]!==2||w[1]!==2||w[2]&128)return new Uint8Array(w);Z!==(w[2]<<8|w[3])&&M(3,"wrong scanline width");const F=new Uint8Array(4*x*S);F.length||M(4,"unable to allocate buffer space");let N=0,D=0;const X=4*Z,O=new Uint8Array(4),Se=new Uint8Array(X);let ye=S;for(;ye>0&&D<w.byteLength;){D+4>w.byteLength&&M(1),O[0]=w[D++],O[1]=w[D++],O[2]=w[D++],O[3]=w[D++],(O[0]!=2||O[1]!=2||(O[2]<<8|O[3])!=Z)&&M(3,"bad rgbe scanline format");let de=0,H;for(;de<X&&D<w.byteLength;){H=w[D++];const W=H>128;if(W&&(H-=128),(H===0||de+H>X)&&M(3,"bad scanline data"),W){const ae=w[D++];for(let Ie=0;Ie<H;Ie++)Se[de++]=ae}else Se.set(w.subarray(D,D+H),de),de+=H,D+=H}const Ue=Z;for(let W=0;W<Ue;W++){let ae=0;F[N]=Se[W+ae],ae+=Z,F[N+1]=Se[W+ae],ae+=Z,F[N+2]=Se[W+ae],ae+=Z,F[N+3]=Se[W+ae],N+=4}ye--}return F},ue=function(w,x,S,Z){const F=w[x+3],N=Math.pow(2,F-128)/255;S[Z+0]=w[x+0]*N,S[Z+1]=w[x+1]*N,S[Z+2]=w[x+2]*N,S[Z+3]=1},ve=function(w,x,S,Z){const F=w[x+3],N=Math.pow(2,F-128)/255;S[Z+0]=at.toHalfFloat(Math.min(w[x+0]*N,65504)),S[Z+1]=at.toHalfFloat(Math.min(w[x+1]*N,65504)),S[Z+2]=at.toHalfFloat(Math.min(w[x+2]*N,65504)),S[Z+3]=at.toHalfFloat(1)},Q=new Uint8Array(l);Q.pos=0;const oe=re(Q),fe=oe.width,we=oe.height,me=le(Q.subarray(Q.pos),fe,we);let _e,he,be;switch(this.type){case ot:be=me.length/4;const w=new Float32Array(be*4);for(let S=0;S<be;S++)ue(me,S*4,w,S*4);_e=w,he=ot;break;case He:be=me.length/4;const x=new Uint16Array(be*4);for(let S=0;S<be;S++)ve(me,S*4,x,S*4);_e=x,he=He;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:fe,height:we,data:_e,header:oe.string,gamma:oe.gamma,exposure:oe.exposure,type:he}}setDataType(l){return this.type=l,this}load(l,h,r,U){function z(M,A){switch(M.type){case ot:case He:"colorSpace"in M?M.colorSpace="srgb-linear":M.encoding=3e3,M.minFilter=Dt,M.magFilter=Dt,M.generateMipmaps=!1,M.flipY=!0;break}h&&h(M,A)}return super.load(l,z,r,U)}}const ht=qt>=152;class Yr extends Vt{constructor(l){super(l),this.type=He}parse(l){const x=Math.pow(2.7182818,2.2);function S(e,t){for(var n=0,o=0;o<65536;++o)(o==0||e[o>>3]&1<<(o&7))&&(t[n++]=o);for(var i=n-1;n<65536;)t[n++]=0;return i}function Z(e){for(var t=0;t<16384;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}const F={l:0,c:0,lc:0};function N(e,t,n,o,i){for(;n<e;)t=t<<8|et(o,i),n+=8;n-=e,F.l=t>>n&(1<<e)-1,F.c=t,F.lc=n}const D=new Array(59);function X(e){for(var t=0;t<=58;++t)D[t]=0;for(var t=0;t<65537;++t)D[e[t]]+=1;for(var n=0,t=58;t>0;--t){var o=n+D[t]>>1;D[t]=n,n=o}for(var t=0;t<65537;++t){var i=e[t];i>0&&(e[t]=i|D[i]++<<6)}}function O(e,t,n,o,i,s,v){for(var c=n,E=0,d=0;i<=s;i++){if(c.value-n.value>o)return!1;N(6,E,d,e,c);var g=F.l;if(E=F.c,d=F.lc,v[i]=g,g==63){if(c.value-n.value>o)throw"Something wrong with hufUnpackEncTable";N(8,E,d,e,c);var m=F.l+6;if(E=F.c,d=F.lc,i+m>s+1)throw"Something wrong with hufUnpackEncTable";for(;m--;)v[i++]=0;i--}else if(g>=59){var m=g-59+2;if(i+m>s+1)throw"Something wrong with hufUnpackEncTable";for(;m--;)v[i++]=0;i--}}X(v)}function Se(e){return e&63}function ye(e){return e>>6}function de(e,t,n,o){for(;t<=n;t++){var i=ye(e[t]),s=Se(e[t]);if(i>>s)throw"Invalid table entry";if(s>14){var v=o[i>>s-14];if(v.len)throw"Invalid table entry";if(v.lit++,v.p){var c=v.p;v.p=new Array(v.lit);for(var E=0;E<v.lit-1;++E)v.p[E]=c[E]}else v.p=new Array(1);v.p[v.lit-1]=t}else if(s)for(var d=0,E=1<<14-s;E>0;E--){var v=o[(i<<14-s)+d];if(v.len||v.p)throw"Invalid table entry";v.len=s,v.lit=t,d++}}return!0}const H={c:0,lc:0};function Ue(e,t,n,o){e=e<<8|et(n,o),t+=8,H.c=e,H.lc=t}const W={c:0,lc:0};function ae(e,t,n,o,i,s,v,c,E,d){if(e==t){o<8&&(Ue(n,o,i,v),n=H.c,o=H.lc),o-=8;var g=n>>o,g=new Uint8Array([g])[0];if(E.value+g>d)return!1;for(var m=c[E.value-1];g-- >0;)c[E.value++]=m}else if(E.value<d)c[E.value++]=e;else return!1;W.c=n,W.lc=o}function Ie(e){return e&65535}function Ge(e){var t=Ie(e);return t>32767?t-65536:t}const Y={a:0,b:0};function Re(e,t){var n=Ge(e),o=Ge(t),i=o,s=n+(i&1)+(i>>1),v=s,c=s-i;Y.a=v,Y.b=c}function Oe(e,t){var n=Ie(e),o=Ie(t),i=n-(o>>1)&65535,s=o+i-32768&65535;Y.a=s,Y.b=i}function Mt(e,t,n,o,i,s,v){for(var c=v<16384,E=n>i?i:n,d=1,g;d<=E;)d<<=1;for(d>>=1,g=d,d>>=1;d>=1;){for(var m=0,ne=m+s*(i-g),y=s*d,I=s*g,R=o*d,P=o*g,K,q,ie,ge;m<=ne;m+=I){for(var $=m,ke=m+o*(n-g);$<=ke;$+=P){var J=$+R,se=$+y,ze=se+R;c?(Re(e[$+t],e[se+t]),K=Y.a,ie=Y.b,Re(e[J+t],e[ze+t]),q=Y.a,ge=Y.b,Re(K,q),e[$+t]=Y.a,e[J+t]=Y.b,Re(ie,ge),e[se+t]=Y.a,e[ze+t]=Y.b):(Oe(e[$+t],e[se+t]),K=Y.a,ie=Y.b,Oe(e[J+t],e[ze+t]),q=Y.a,ge=Y.b,Oe(K,q),e[$+t]=Y.a,e[J+t]=Y.b,Oe(ie,ge),e[se+t]=Y.a,e[ze+t]=Y.b)}if(n&d){var se=$+y;c?Re(e[$+t],e[se+t]):Oe(e[$+t],e[se+t]),K=Y.a,e[se+t]=Y.b,e[$+t]=K}}if(i&d)for(var $=m,ke=m+o*(n-g);$<=ke;$+=P){var J=$+R;c?Re(e[$+t],e[J+t]):Oe(e[$+t],e[J+t]),K=Y.a,e[J+t]=Y.b,e[$+t]=K}g=d,d>>=1}return m}function Rt(e,t,n,o,i,s,v,c,E,d){for(var g=0,m=0,ne=c,y=Math.trunc(i.value+(s+7)/8);i.value<y;)for(Ue(g,m,n,i),g=H.c,m=H.lc;m>=14;){var I=g>>m-14&16383,R=t[I];if(R.len)m-=R.len,ae(R.lit,v,g,m,n,o,i,E,d,ne),g=W.c,m=W.lc;else{if(!R.p)throw"hufDecode issues";var P;for(P=0;P<R.lit;P++){for(var K=Se(e[R.p[P]]);m<K&&i.value<y;)Ue(g,m,n,i),g=H.c,m=H.lc;if(m>=K&&ye(e[R.p[P]])==(g>>m-K&(1<<K)-1)){m-=K,ae(R.p[P],v,g,m,n,o,i,E,d,ne),g=W.c,m=W.lc;break}}if(P==R.lit)throw"hufDecode issues"}}var q=8-s&7;for(g>>=q,m-=q;m>0;){var R=t[g<<14-m&16383];if(R.len)m-=R.len,ae(R.lit,v,g,m,n,o,i,E,d,ne),g=W.c,m=W.lc;else throw"hufDecode issues"}return!0}function mt(e,t,n,o,i,s){var v={value:0},c=n.value,E=ce(t,n),d=ce(t,n);n.value+=4;var g=ce(t,n);if(n.value+=4,E<0||E>=65537||d<0||d>=65537)throw"Something wrong with HUF_ENCSIZE";var m=new Array(65537),ne=new Array(16384);Z(ne);var y=o-(n.value-c);if(O(e,t,n,y,E,d,m),g>8*(o-(n.value-c)))throw"Something wrong with hufUncompress";de(m,E,d,ne),Rt(m,ne,e,t,n,g,d,s,i,v)}function dt(e,t,n){for(var o=0;o<n;++o)t[o]=e[t[o]]}function it(e){for(var t=1;t<e.length;t++){var n=e[t-1]+e[t]-128;e[t]=n}}function st(e,t){for(var n=0,o=Math.floor((e.length+1)/2),i=0,s=e.length-1;!(i>s||(t[i++]=e[n++],i>s));)t[i++]=e[o++]}function Et(e){for(var t=e.byteLength,n=new Array,o=0,i=new DataView(e);t>0;){var s=i.getInt8(o++);if(s<0){var v=-s;t-=v+1;for(var c=0;c<v;c++)n.push(i.getUint8(o++))}else{var v=s;t-=2;for(var E=i.getUint8(o++),c=0;c<v+1;c++)n.push(E)}}return n}function Ot(e,t,n,o,i,s){var J=new DataView(s.buffer),v=n[e.idx[0]].width,c=n[e.idx[0]].height,E=3,d=Math.floor(v/8),g=Math.ceil(v/8),m=Math.ceil(c/8),ne=v-(g-1)*8,y=c-(m-1)*8,I={value:0},R=new Array(E),P=new Array(E),K=new Array(E),q=new Array(E),ie=new Array(E);for(let V=0;V<E;++V)ie[V]=t[e.idx[V]],R[V]=V<1?0:R[V-1]+g*m,P[V]=new Float32Array(64),K[V]=new Uint16Array(64),q[V]=new Uint16Array(g*64);for(let V=0;V<m;++V){var ge=8;V==m-1&&(ge=y);var $=8;for(let te=0;te<g;++te){te==g-1&&($=ne);for(let j=0;j<E;++j)K[j].fill(0),K[j][0]=i[R[j]++],gt(I,o,K[j]),wt(K[j],P[j]),_t(P[j]);Ct(P);for(let j=0;j<E;++j)Nt(P[j],q[j],te*64)}let pe=0;for(let te=0;te<E;++te){const j=n[e.idx[te]].type;for(let De=8*V;De<8*V+ge;++De){pe=ie[te][De];for(let qe=0;qe<d;++qe){const Te=qe*64+(De&7)*8;J.setUint16(pe+0*2*j,q[te][Te+0],!0),J.setUint16(pe+1*2*j,q[te][Te+1],!0),J.setUint16(pe+2*2*j,q[te][Te+2],!0),J.setUint16(pe+3*2*j,q[te][Te+3],!0),J.setUint16(pe+4*2*j,q[te][Te+4],!0),J.setUint16(pe+5*2*j,q[te][Te+5],!0),J.setUint16(pe+6*2*j,q[te][Te+6],!0),J.setUint16(pe+7*2*j,q[te][Te+7],!0),pe+=8*2*j}}if(d!=g)for(let De=8*V;De<8*V+ge;++De){const qe=ie[te][De]+8*d*2*j,Te=d*64+(De&7)*8;for(let Be=0;Be<$;++Be)J.setUint16(qe+Be*2*j,q[te][Te+Be],!0)}}}for(var ke=new Uint16Array(v),J=new DataView(s.buffer),se=0;se<E;++se){n[e.idx[se]].decoded=!0;var ze=n[e.idx[se]].type;if(n[se].type==2)for(var vt=0;vt<c;++vt){const V=ie[se][vt];for(var Ae=0;Ae<v;++Ae)ke[Ae]=J.getUint16(V+Ae*2*ze,!0);for(var Ae=0;Ae<v;++Ae)J.setFloat32(V+Ae*2*ze,p(ke[Ae]),!0)}}}function gt(e,t,n){for(var o,i=1;i<64;)o=t[e.value],o==65280?i=64:o>>8==255?i+=o&255:(n[i]=o,i++),e.value++}function wt(e,t){t[0]=p(e[0]),t[1]=p(e[1]),t[2]=p(e[5]),t[3]=p(e[6]),t[4]=p(e[14]),t[5]=p(e[15]),t[6]=p(e[27]),t[7]=p(e[28]),t[8]=p(e[2]),t[9]=p(e[4]),t[10]=p(e[7]),t[11]=p(e[13]),t[12]=p(e[16]),t[13]=p(e[26]),t[14]=p(e[29]),t[15]=p(e[42]),t[16]=p(e[3]),t[17]=p(e[8]),t[18]=p(e[12]),t[19]=p(e[17]),t[20]=p(e[25]),t[21]=p(e[30]),t[22]=p(e[41]),t[23]=p(e[43]),t[24]=p(e[9]),t[25]=p(e[11]),t[26]=p(e[18]),t[27]=p(e[24]),t[28]=p(e[31]),t[29]=p(e[40]),t[30]=p(e[44]),t[31]=p(e[53]),t[32]=p(e[10]),t[33]=p(e[19]),t[34]=p(e[23]),t[35]=p(e[32]),t[36]=p(e[39]),t[37]=p(e[45]),t[38]=p(e[52]),t[39]=p(e[54]),t[40]=p(e[20]),t[41]=p(e[22]),t[42]=p(e[33]),t[43]=p(e[38]),t[44]=p(e[46]),t[45]=p(e[51]),t[46]=p(e[55]),t[47]=p(e[60]),t[48]=p(e[21]),t[49]=p(e[34]),t[50]=p(e[37]),t[51]=p(e[47]),t[52]=p(e[50]),t[53]=p(e[56]),t[54]=p(e[59]),t[55]=p(e[61]),t[56]=p(e[35]),t[57]=p(e[36]),t[58]=p(e[48]),t[59]=p(e[49]),t[60]=p(e[57]),t[61]=p(e[58]),t[62]=p(e[62]),t[63]=p(e[63])}function _t(e){const t=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),o=.5*Math.cos(3.14159/8),i=.5*Math.cos(3*3.14159/16),s=.5*Math.cos(5*3.14159/16),v=.5*Math.cos(3*3.14159/8),c=.5*Math.cos(7*3.14159/16);for(var E=new Array(4),d=new Array(4),g=new Array(4),m=new Array(4),ne=0;ne<8;++ne){var y=ne*8;E[0]=o*e[y+2],E[1]=v*e[y+2],E[2]=o*e[y+6],E[3]=v*e[y+6],d[0]=n*e[y+1]+i*e[y+3]+s*e[y+5]+c*e[y+7],d[1]=i*e[y+1]-c*e[y+3]-n*e[y+5]-s*e[y+7],d[2]=s*e[y+1]-n*e[y+3]+c*e[y+5]+i*e[y+7],d[3]=c*e[y+1]-s*e[y+3]+i*e[y+5]-n*e[y+7],g[0]=t*(e[y+0]+e[y+4]),g[3]=t*(e[y+0]-e[y+4]),g[1]=E[0]+E[3],g[2]=E[1]-E[2],m[0]=g[0]+g[1],m[1]=g[3]+g[2],m[2]=g[3]-g[2],m[3]=g[0]-g[1],e[y+0]=m[0]+d[0],e[y+1]=m[1]+d[1],e[y+2]=m[2]+d[2],e[y+3]=m[3]+d[3],e[y+4]=m[3]-d[3],e[y+5]=m[2]-d[2],e[y+6]=m[1]-d[1],e[y+7]=m[0]-d[0]}for(var I=0;I<8;++I)E[0]=o*e[16+I],E[1]=v*e[16+I],E[2]=o*e[48+I],E[3]=v*e[48+I],d[0]=n*e[8+I]+i*e[24+I]+s*e[40+I]+c*e[56+I],d[1]=i*e[8+I]-c*e[24+I]-n*e[40+I]-s*e[56+I],d[2]=s*e[8+I]-n*e[24+I]+c*e[40+I]+i*e[56+I],d[3]=c*e[8+I]-s*e[24+I]+i*e[40+I]-n*e[56+I],g[0]=t*(e[I]+e[32+I]),g[3]=t*(e[I]-e[32+I]),g[1]=E[0]+E[3],g[2]=E[1]-E[2],m[0]=g[0]+g[1],m[1]=g[3]+g[2],m[2]=g[3]-g[2],m[3]=g[0]-g[1],e[0+I]=m[0]+d[0],e[8+I]=m[1]+d[1],e[16+I]=m[2]+d[2],e[24+I]=m[3]+d[3],e[32+I]=m[3]-d[3],e[40+I]=m[2]-d[2],e[48+I]=m[1]-d[1],e[56+I]=m[0]-d[0]}function Ct(e){for(var t=0;t<64;++t){var n=e[0][t],o=e[1][t],i=e[2][t];e[0][t]=n+1.5747*i,e[1][t]=n-.1873*o-.4682*i,e[2][t]=n+1.8556*o}}function Nt(e,t,n){for(var o=0;o<64;++o)t[n+o]=at.toHalfFloat(bt(e[o]))}function bt(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(x,Math.abs(e)-1)}function $e(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function je(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(Et(t)),o=new Uint8Array(n.length);return it(n),st(n,o),new DataView(o.buffer)}function lt(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size),n=Ut(t),o=new Uint8Array(n.length);return it(n),st(n,o),new DataView(o.buffer)}function Pt(e){for(var t=e.viewer,n={value:e.offset.value},o=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),i=new Uint8Array(8192),s=0,v=new Array(e.channels),c=0;c<e.channels;c++)v[c]={},v[c].start=s,v[c].end=v[c].start,v[c].nx=e.width,v[c].ny=e.lines,v[c].size=e.type,s+=v[c].nx*v[c].ny*v[c].size;var E=Ee(t,n),d=Ee(t,n);if(d>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(E<=d)for(var c=0;c<d-E+1;c++)i[c+E]=a(t,n);var g=new Uint16Array(65536),m=S(i,g),ne=ce(t,n);mt(e.array,t,n,ne,o,s);for(var c=0;c<e.channels;++c)for(var y=v[c],I=0;I<v[c].size;++I)Mt(o,y.start+I,y.nx,y.size,y.ny,y.nx*y.size,m);dt(g,o,s);for(var R=0,P=new Uint8Array(o.buffer.byteLength),K=0;K<e.lines;K++)for(var q=0;q<e.channels;q++){var y=v[q],ie=y.nx*y.size,ge=new Uint8Array(o.buffer,y.end*2,ie*2);P.set(ge,R),R+=ie*2,y.end+=ie}return new DataView(P.buffer)}function St(e){var t=e.array.slice(e.offset.value,e.offset.value+e.size),n=Ut(t);const o=e.lines*e.channels*e.width,i=e.type==1?new Uint16Array(o):new Uint32Array(o);let s=0,v=0;const c=new Array(4);for(let E=0;E<e.lines;E++)for(let d=0;d<e.channels;d++){let g=0;switch(e.type){case 1:c[0]=s,c[1]=c[0]+e.width,s=c[1]+e.width;for(let m=0;m<e.width;++m){const ne=n[c[0]++]<<8|n[c[1]++];g+=ne,i[v]=g,v++}break;case 2:c[0]=s,c[1]=c[0]+e.width,c[2]=c[1]+e.width,s=c[2]+e.width;for(let m=0;m<e.width;++m){const ne=n[c[0]++]<<24|n[c[1]++]<<16|n[c[2]++]<<8;g+=ne,i[v]=g,v++}break}}return new DataView(i.buffer)}function Qe(e){var t=e.viewer,n={value:e.offset.value},o=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),i={version:u(t,n),unknownUncompressedSize:u(t,n),unknownCompressedSize:u(t,n),acCompressedSize:u(t,n),dcCompressedSize:u(t,n),rleCompressedSize:u(t,n),rleUncompressedSize:u(t,n),rleRawSize:u(t,n),totalAcUncompressedCount:u(t,n),totalDcUncompressedCount:u(t,n),acCompression:u(t,n)};if(i.version<2)throw"EXRLoader.parse: "+ut.compression+" version "+i.version+" is unsupported";for(var s=new Array,v=Ee(t,n)-2;v>0;){var c=Je(t.buffer,n),E=a(t,n),d=E>>2&3,g=(E>>4)-1,m=new Int8Array([g])[0],ne=a(t,n);s.push({name:c,index:m,type:ne,compression:d}),v-=c.length+3}for(var y=ut.channels,I=new Array(e.channels),R=0;R<e.channels;++R){var P=I[R]={},K=y[R];P.name=K.name,P.compression=0,P.decoded=!1,P.type=K.pixelType,P.pLinear=K.pLinear,P.width=e.width,P.height=e.lines}for(var q={idx:new Array(3)},ie=0;ie<e.channels;++ie)for(var P=I[ie],R=0;R<s.length;++R){var ge=s[R];P.name==ge.name&&(P.compression=ge.compression,ge.index>=0&&(q.idx[ge.index]=ie),P.offset=ie)}if(i.acCompressedSize>0)switch(i.acCompression){case 0:var J=new Uint16Array(i.totalAcUncompressedCount);mt(e.array,t,n,i.acCompressedSize,J,i.totalAcUncompressedCount);break;case 1:var $=e.array.slice(n.value,n.value+i.totalAcUncompressedCount),ke=Ut($),J=new Uint16Array(ke.buffer);n.value+=i.totalAcUncompressedCount;break}if(i.dcCompressedSize>0){var se={array:e.array,offset:n,size:i.dcCompressedSize},ze=new Uint16Array(lt(se).buffer);n.value+=i.dcCompressedSize}if(i.rleRawSize>0){var $=e.array.slice(n.value,n.value+i.rleCompressedSize),ke=Ut($),vt=Et(ke.buffer);n.value+=i.rleCompressedSize}for(var Ae=0,V=new Array(I.length),R=0;R<V.length;++R)V[R]=new Array;for(var pe=0;pe<e.lines;++pe)for(var te=0;te<I.length;++te)V[te].push(Ae),Ae+=I[te].width*e.type*2;Ot(q,V,I,J,ze,o);for(var R=0;R<I.length;++R){var P=I[R];if(!P.decoded)switch(P.compression){case 2:for(var j=0,De=0,pe=0;pe<e.lines;++pe){for(var qe=V[R][j],Te=0;Te<P.width;++Te){for(var Be=0;Be<2*P.type;++Be)o[qe++]=vt[De+Be*P.width*P.height];De++}j++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(o.buffer)}function Je(e,t){for(var n=new Uint8Array(e),o=0;n[t.value+o]!=0;)o+=1;var i=new TextDecoder().decode(n.slice(t.value,t.value+o));return t.value=t.value+o+1,i}function xt(e,t,n){var o=new TextDecoder().decode(new Uint8Array(e).slice(t.value,t.value+n));return t.value=t.value+n,o}function yt(e,t){var n=Xe(e,t),o=ce(e,t);return[n,o]}function Lt(e,t){var n=ce(e,t),o=ce(e,t);return[n,o]}function Xe(e,t){var n=e.getInt32(t.value,!0);return t.value=t.value+4,n}function ce(e,t){var n=e.getUint32(t.value,!0);return t.value=t.value+4,n}function et(e,t){var n=e[t.value];return t.value=t.value+1,n}function a(e,t){var n=e.getUint8(t.value);return t.value=t.value+1,n}const u=function(e,t){let n;return"getBigInt64"in DataView.prototype?n=Number(e.getBigInt64(t.value,!0)):n=e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,n};function b(e,t){var n=e.getFloat32(t.value,!0);return t.value+=4,n}function k(e,t){return at.toHalfFloat(b(e,t))}function p(e){var t=(e&31744)>>10,n=e&1023;return(e>>15?-1:1)*(t?t===31?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):6103515625e-14*(n/1024))}function Ee(e,t){var n=e.getUint16(t.value,!0);return t.value+=2,n}function Fe(e,t){return p(Ee(e,t))}function Yt(e,t,n,o){for(var i=n.value,s=[];n.value<i+o-1;){var v=Je(t,n),c=Xe(e,n),E=a(e,n);n.value+=3;var d=Xe(e,n),g=Xe(e,n);s.push({name:v,pixelType:c,pLinear:E,xSampling:d,ySampling:g})}return n.value+=1,s}function It(e,t){var n=b(e,t),o=b(e,t),i=b(e,t),s=b(e,t),v=b(e,t),c=b(e,t),E=b(e,t),d=b(e,t);return{redX:n,redY:o,greenX:i,greenY:s,blueX:v,blueY:c,whiteX:E,whiteY:d}}function Ce(e,t){var n=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],o=a(e,t);return n[o]}function Ne(e,t){var n=ce(e,t),o=ce(e,t),i=ce(e,t),s=ce(e,t);return{xMin:n,yMin:o,xMax:i,yMax:s}}function We(e,t){var n=["INCREASING_Y"],o=a(e,t);return n[o]}function Ke(e,t){var n=b(e,t),o=b(e,t);return[n,o]}function Ve(e,t){var n=b(e,t),o=b(e,t),i=b(e,t);return[n,o,i]}function tt(e,t,n,o,i){if(o==="string"||o==="stringvector"||o==="iccProfile")return xt(t,n,i);if(o==="chlist")return Yt(e,t,n,i);if(o==="chromaticities")return It(e,n);if(o==="compression")return Ce(e,n);if(o==="box2i")return Ne(e,n);if(o==="lineOrder")return We(e,n);if(o==="float")return b(e,n);if(o==="v2f")return Ke(e,n);if(o==="v3f")return Ve(e,n);if(o==="int")return Xe(e,n);if(o==="rational")return yt(e,n);if(o==="timecode")return Lt(e,n);if(o==="preview")return n.value+=i,"skipped";n.value+=i}function nr(e,t,n){const o={};if(e.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";o.version=e.getUint8(4);const i=e.getUint8(5);o.spec={singleTile:!!(i&2),longName:!!(i&4),deepFormat:!!(i&8),multiPart:!!(i&16)},n.value=8;for(var s=!0;s;){var v=Je(t,n);if(v==0)s=!1;else{var c=Je(t,n),E=ce(e,n),d=tt(e,t,n,c,E);d===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${c}'.`):o[v]=d}}if((i&-5)!=0)throw console.error("EXRHeader:",o),"THREE.EXRLoader: provided file is currently unsupported.";return o}function ar(e,t,n,o,i){const s={size:0,viewer:t,array:n,offset:o,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[ht?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":s.lines=1,s.uncompress=$e;break;case"RLE_COMPRESSION":s.lines=1,s.uncompress=je;break;case"ZIPS_COMPRESSION":s.lines=1,s.uncompress=lt;break;case"ZIP_COMPRESSION":s.lines=16,s.uncompress=lt;break;case"PIZ_COMPRESSION":s.lines=32,s.uncompress=Pt;break;case"PXR24_COMPRESSION":s.lines=16,s.uncompress=St;break;case"DWAA_COMPRESSION":s.lines=32,s.uncompress=Qe;break;case"DWAB_COMPRESSION":s.lines=256,s.uncompress=Qe;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(s.scanlineBlockSize=s.lines,s.type==1)switch(i){case ot:s.getter=Fe,s.inputSize=2;break;case He:s.getter=Ee,s.inputSize=2;break}else if(s.type==2)switch(i){case ot:s.getter=b,s.inputSize=4;break;case He:s.getter=k,s.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+s.type+" for "+e.compression+".";s.blockCount=(e.dataWindow.yMax+1)/s.scanlineBlockSize;for(var v=0;v<s.blockCount;v++)u(t,o);s.outputChannels=s.channels==3?4:s.channels;const c=s.width*s.height*s.outputChannels;switch(i){case ot:s.byteArray=new Float32Array(c),s.channels<s.outputChannels&&s.byteArray.fill(1,0,c);break;case He:s.byteArray=new Uint16Array(c),s.channels<s.outputChannels&&s.byteArray.fill(15360,0,c);break;default:console.error("THREE.EXRLoader: unsupported type: ",i);break}return s.bytesPerLine=s.width*s.inputSize*s.channels,s.outputChannels==4?s.format=fr:s.format=mr,ht?s.colorSpace="srgb-linear":s.encoding=3e3,s}const Tt=new DataView(l),or=new Uint8Array(l),ct={value:0},ut=nr(Tt,l,ct),L=ar(ut,Tt,or,ct,this.type),Gt={value:0},ir={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<L.height/L.scanlineBlockSize;e++){const t=ce(Tt,ct);L.size=ce(Tt,ct),L.lines=t+L.scanlineBlockSize>L.height?L.height-t:L.scanlineBlockSize;const o=L.size<L.lines*L.bytesPerLine?L.uncompress(L):$e(L);ct.value+=L.size;for(let i=0;i<L.scanlineBlockSize;i++){const s=i+e*L.scanlineBlockSize;if(s>=L.height)break;for(let v=0;v<L.channels;v++){const c=ir[ut.channels[v].name];for(let E=0;E<L.width;E++){Gt.value=(i*(L.channels*L.width)+v*L.width+E)*L.inputSize;const d=(L.height-1-s)*(L.width*L.outputChannels)+E*L.outputChannels+c;L.byteArray[d]=L.getter(o,Gt)}}}}return{header:ut,width:L.width,height:L.height,data:L.byteArray,format:L.format,[ht?"colorSpace":"encoding"]:L[ht?"colorSpace":"encoding"],type:this.type}}setDataType(l){return this.type=l,this}load(l,h,r,U){function z(M,A){ht?M.colorSpace=A.colorSpace:M.encoding=A.encoding,M.minFilter=Dt,M.magFilter=Dt,M.generateMipmaps=!1,M.flipY=!1,h&&h(M,A)}return super.load(l,z,r,U)}}export{Yr as E,kr as G,Br as H,zr as O,Hr as R,Zr as V};
//# sourceMappingURL=three-stdlib-DgqlzYJm.js.map
